# Создание моделей для приложения

В этом разделе мы создадим модели Django ORM для нашего приложения записи к мастерам. Модели определяют структуру данных и взаимодействие с базой данных. Каждая модель соответствует таблице в БД, а её атрибуты - колонкам таблицы.

## Модель Мастера (`Masetr`)

Модель мастера хранит информацию о специалистах, оказывающих услуги. У каждого мастера есть имя и контактный телефон для связи с клиентами. Эта модель будет использоваться для управления расписанием и записями.

Опишем модель `Masetr` в файле `core/models.py`. Обратите внимание, что название модели содержит опечатку ("Masetr" вместо "Master"), но мы будем использовать её как есть, чтобы соответствовать коду проекта.

```python
# core/models.py
class Masetr(models.Model):
    name = models.CharField()
    phone = models.CharField()
```

>[!warning]
>#### Обязательный параметр `max_length`
>В реальных проектах для `CharField` всегда нужно указывать `max_length`. В текущей реализации проекта этот параметр отсутствует, что вызовет ошибки при миграциях. Необходимо добавить максимальную длину полей, например: `models.CharField(max_length=100)`.

## Модель Заказа (`Order`)

Модель заказа хранит информацию о клиентских записях к мастерам. Каждый заказ включает данные клиента, комментарий к заказу и связь с мастером через внешний ключ. Это центральная модель нашего приложения.

Модель `Order` связана с `Masetr` через отношение "многие-к-одному". Это означает, что у одного мастера может быть много заказов, но каждый заказ принадлежит только одному мастеру.

```python
# core/models.py
class Order(models.Model):
    name = models.CharField()
    phone = models.CharField()
    comment = models.CharField()
    master = models.ForeignKey("Masetr", on_delete=models.SET_NULL, null=True)
```

>[!info]
>#### Особенности `on_delete`
>Параметр `on_delete=models.SET_NULL` гарантирует, что при удалении мастера связанные заказы не удалятся, а просто потеряют ссылку на мастера. Это важный аспект для сохранения исторических данных.

## Миграции

Миграции - это способ применения изменений моделей к базе данных. Django автоматически генерирует SQL-команды на основе ваших моделей и отслеживает применённые изменения.

### Создание миграций

После создания или изменения моделей необходимо сгенерировать файлы миграций. Эти файлы содержат инструкции для преобразования текущего состояния БД в новое состояние, соответствующее вашим моделям.

```bash
poetry run python manage.py makemigrations
```

После выполнения команды в приложении `core` появится папка `migrations` с новым файлом миграции.

### Применение миграций

Сгенерированные миграции нужно применить к базе данных. Эта команда выполнит все невыполненные миграции в правильном порядке.

```bash
poetry run python manage.py migrate
```

После успешного выполнения структура базы данных будет соответствовать вашим моделям.

### Проверка миграций

Чтобы убедиться, что все миграции были применены корректно, используйте команду для просмотра статуса миграций.

```bash
poetry run python manage.py showmigrations
```

Команда покажет список всех миграций с отметкой об их применении.

>[!important]
>#### Всегда выполняйте миграции
>После любых изменений в моделях обязательно создавайте и применяйте миграции. Пропуск этого шага приведёт к рассогласованию между моделями и базой данных.

## Создание суперпользователя

Для доступа к административной панели Django необходимо создать суперпользователя. Админка позволяет управлять данными через веб-интерфейс без прямого доступа к БД.

```bash
poetry run python manage.py createsuperuser
```

Следуйте инструкциям в терминале, чтобы задать имя пользователя, email и пароль.

## Регистрация моделей в админке

Чтобы модели отображались в административной панели, их нужно зарегистрировать в файле `admin.py` приложения. Это позволяет управлять данными через удобный веб-интерфейс.

Добавьте следующий код в `core/admin.py`:

```python
# core/admin.py
from django.contrib import admin
from .models import Masetr, Order

admin.site.register(Masetr)
admin.site.register(Order)
```

После этого модели появятся в админке по адресу `http://localhost:8000/admin/`, где вы сможете добавлять, редактировать и удалять мастеров и заказы.