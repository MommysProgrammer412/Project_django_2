# Тема Django. MTV. Знакомство с Шаблонизатором и маршрутизацией. Урок 51 Ч2 - Шаблоны

## Знакомство с шаблонизатором Django

- Что такое шаблонизатор
- Какую проблему он решает

## Места хранения шаблонов

### Стандартные варианты и лучшие практики


- Где Django по умолчанию ищет шаблоны (рекурсивный обход приложений ./templates/)
- Как подлкючить свои варианты мест, где могут лежать шаблоны


Воспользуемся стандартным местом размещения шаблонов и сделаем шаблон в `./core/templates/core/thanks.html`
Зачем так сложно?
- Django ищет шаблоны в папке `templates` каждого приложения
- Может быть 2 шаблона с одним именем в разных приложениях

Мы указываем в `render` путь к шаблону относительно папки `templates`
Например `core/thanks.html`

Если у нас есть приложение `users` мы можем разместить шаблоны по пути `users/templates/users/thanks.html`
И указать в `render` путь `users/thanks.html`

### Альтернативное место хранения

Для небольших проектов, мы можем размещать все шаблоны в одном месте в корне проекта `./templates`
Наш шаблон будет лажеть по адресу `./templates/thanks.html`

Но тут есть проблема. Django не будет искать шаблоны там.
Надо в настройках подсказать ему, где искать шаблоны.

```python
# settings.py
TEMPLATES = [
    {
        'BACKEND': 'django.template.backends.django.DjangoTemplates',
        'DIRS': [BASE_DIR / 'templates'],
        'APP_DIRS': True,
```

Что за деление между `BASE_DIR` и `'templates'`?

BASE_DIR = Path(__file__).resolve().parent.parent
django_413/barbershop/settings.py
"C:\PY\ПРИМЕРЫ КОДА\django_consult_413"


BASE_DIR / 'templates' = C:\PY\ПРИМЕРЫ КОДА\django_consult_413\templates


## Установка плагина Django для VS Code

Вам нужно будет установить плагин Django

![django_plugin.png](./images/django_plugin.png)


Расширение Django (автор: Baptiste Darthenay) предоставляет дополнительные возможности при работе с проектами Django в VS Code:

- Подсветка синтаксиса в шаблонах Django (*.html,*.djhtml)
- Автодополнение тегов и фильтров Django
- Улучшенная навигация по шаблонам
- Подсветка синтаксиса в файлах settings.py, urls.py и других файлах Django

### Установка плагина

Для установки расширения Django необходимо:

1. Откройте панель расширений (Ctrl+Shift+X)
2. Введите "Django" в поиске
3. Найдите расширение от Baptiste Darthenay
4. Нажмите кнопку "Установить"

### Настройка расширения

После установки расширения рекомендуется настроить его для оптимальной работы. Для этого:

1. Откройте настройки VS Code (Ctrl+,)
2. В правом верхнем углу нажмите на иконку с тремя точками и выберите `Open Settings (JSON)`
3. Добавьте следующие настройки для улучшения работы с шаблонами Django:

```json
"[django-html]": {
    "breadcrumbs.showClasses": true,         // Отображение классов в панели навигации
    "editor.formatOnSave": false,            // Отключение автоформатирования при сохранении
    "editor.quickSuggestions": {             // Включение быстрых подсказок в шаблонах
        "other": true,                       // Для обычного текста
        "comments": true,                    // Для комментариев
        "strings": true                      // Для строк (важно для шаблонов)
    }
}
```

Эти настройки позволяют:

- Видеть структуру шаблона в панели хлебных крошек
- Отключить автоматическое форматирование, которое может испортить шаблоны Django
- Включить подсказки во всех контекстах шаблона, включая строки и комментарии

4. Для улучшения автодополнения и анализа кода Django добавьте следующие настройки:

```json
"python.analysis.packageIndexDepths": [
    {
        "name": "django",                   // Пакет Django
        "depth": 5,                         // Глубина анализа (3 уровня вложенности)
        "includeAllSymbols": true           // Включить все символы для анализа
    },
    {
        "name": "selenium",                 // Для тестирования веб-интерфейса
        "depth": 3,
        "includeAllSymbols": true
    },
    {
        "name": "sqlalchemy",               // Для работы с ORM (если используется)
        "depth": 3,
        "includeAllSymbols": true
    },
    {
        "name": "sqlite3",                  // Для работы с базой данных
        "depth": 3,
        "includeAllSymbols": true
    }
]
```

Эти настройки улучшают работу IntelliSense (автодополнение и подсказки) в VS Code:

- Увеличивают глубину анализа популярных пакетов до 3 уровней вложенности
- Включают все символы этих пакетов для автодополнения
- Значительно улучшают подсказки при работе с Django моделями, формами и ORM

### Базовые настройки Emmet для Django

```json
"emmet.includeLanguages": {
  "django-html": "html"
}
```

Активирует поддержку Emmet в шаблонах Django, позволяя использовать сокращения HTML.

Но можно дать расширенные настройки Emmet для Django-шаблонов, чтобы улучшить работу с HTML и Django-тегами.

```json
"emmet.triggerExpansionOnTab": true,
"emmet.showSuggestionsAsSnippets": true,
"emmet.showExpandedAbbreviation": "always",
"emmet.useInlineCompletions": true,
"emmet.extensionsPath": [],
"emmet.syntaxProfiles": {
  "html": {
    "filters.commentAfter": "<!-- /{[#]}/ -->",
    "attributes": {
      "class": "class",
      "id": "id",
      "for": "for"
    }
  },
  "django-html": {
    "filters.commentAfter": "{# /{[#]}/ #}"
  }
}
```

Особенно важны:

`emmet.triggerExpansionOnTab: true` - позволяет разворачивать аббревиатуры Emmet нажатием Tab
`emmet.syntaxProfiles` - настраивает Emmet для работы с Django-специфичными конструкциями, например комментарии в формате {# комментарий #}

### Преимущества расширения Django

1. **Улучшенная работа с шаблонами**:
   - Подсветка тегов и фильтров Django в HTML-файлах
   - Автоматическое закрытие тегов Django ({% %})
   - Автодополнение встроенных тегов и фильтров

2. **Улучшенная навигация в проекте**:
   - Переход к определению шаблонов из представлений
   - Просмотр структуры шаблонов в панели навигации
   - Структурированное отображение блоков в шаблонах

3. **Дополнительные сниппеты**:
   - Быстрое создание представлений, URL-маршрутов и моделей
   - Шаблоны для часто используемых конструкций Django

4. **Интеграция с другими расширениями**:
   - Работает совместно с расширением Python
   - Дополняет функционал отладчика для Django-проектов

Использование расширения Django значительно повышает удобство разработки проектов на Django в VS Code и ускоряет процесс написания кода.

## Первый шаблон Django

Мы создали в корне проекта папку `templates` и добавили в нее файл `thanks.html`.
У нас есть маршрут `thanks/`, который отвечает за отображение этого шаблона.
А так же у нас есть представление `thanks`, которое отвечает за этот маршрут.

```python
def thanks(request):
    """
    Отвечает за маршрут 'thanks/'
    """
    return render(request, "thanks.html")
```

- Пояснения за рендер на стороне сервера
- Рассказ про функцию `render` и её 2 обязательных аргумента








#### 1. Настройка шаблонов (25 мин)
- **Ключевые технологии**:
  - `TEMPLATES.DIRS` - добавление пути к шаблонам
  ```python
  # settings.py
  TEMPLATES = [
      {
          'DIRS': [os.path.join(BASE_DIR, 'templates')],
      }
  ]
  ```
  - `os.path.join()` - кроссплатформенные пути
  - Структура папок шаблонов:
    - `templates/` (корень проекта)
    - `templates/core/` (для приложения)

#### 2. Маршрутизация (40 мин)
- **Основные методы**:
  - `path()` - параметры и синтаксис:
    ```python
    # urls.py
    path(
        'orders/<int:order_id>/',  # URL с параметром
        views.order_detail,         # view-функция
        name='order_detail'         # имя маршрута
    )
    ```
  - Конвертеры путей: `int`, `str`, `slug`
  - Именованные маршруты: `reverse('route_name')`

#### 3. Работа с представлениями (45 мин)
- **Технологии**:
  - `render()` - параметры и контекст:
    ```python
    return render(
        request,
        'core/order_detail.html',  # путь к шаблону
        {'order': order_data}       # контекст
    )
    ```
  - `HttpResponse` vs `render` - когда использовать
  - Формирование контекста:
    - Передача списков словарей
    - Фильтрация данных в представлении